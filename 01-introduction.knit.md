
# (PART) General Functionality {-} 

# Introduction {#introduction}

Circular layout is very useful to represent complicated information. First, it
elegantly represents information with long axes or a large amount of
categories; second, it intuitively shows data with multiple tracks focusing on
the same object; third, it easily demonstrates relations between elements. It
provides an efficient way to arrange information on the circle and it is
beautiful.

[**Circos**](http://circos.ca) is a pioneer tool widely used for circular
layout representations implemented in _Perl_. It greatly enhances the
visualization of scientific results (especially in Genomics field). Thus,
plots with circular layout are normally named as **"circos plot"**. Here the
**circlize** package aims to implement **Circos** in R. One important
advantage for the implementation in R is that R is an ideal environment which
provides seamless connection between data analysis and data visualization.
**circlize** is not a front-end wrapper to generate configuration files for
**Circos**, while completely coded in R style by using R's elegant statistical
and graphic engine. We aim to keep the flexibility and configurability of
**Circos**, but also make the package more straightforward to use and enhance
it to support more types of graphics.

In this book, chapters in Part I give detailed overviews of the general **circlize**
functionalities. Part II introduces functions specifically designed for
visualizing genomic datasets. Part III gives comprehensive guilds on
visualizing relationships by Chord diagram.

## Principle of design

A circular layout is composed of sectors and tracks. For data in different
categories, they are allocated into different sectors and for multiple
measurements of the same category, they are represented as stacked tracks from
outside of the circle to the inside. The intersection of a sector and a track
is called a cell (or a grid, a panel), which is the basic unit in a circular
layout. It is an imaginary plotting region for data points in a certain
category.

Since most of the figures are composed of simple graphics, such as points,
lines, polygon, **circlize** implements low-level graphic functions for adding
graphics in the circular plotting regions, so that more complicated graphics
can be easily generated by different combinations of low-level graphic
functions. This principle ensures the generality that types of high-level
graphics are not restricted by the software itself and high-level packages
focusing on specific interests can be built on it.

Currently there are following low-level graphic functions that can be used for
adding graphics. The usage is very similar to the functions without `circos.`
prefix from the base graphic engine, except there are some enhancement
specifically designed for circular visualization.

- `circos.points()`: adds points in a cell.
- `circos.lines()`: adds lines in a cell.
- `circos.segments()`: adds segments in a cell.
- `circos.rect()`: adds rectangles in a cell.
- `circos.polygon()`: adds polygons in a cell.
- `circos.text()`: adds text in a cell.
- `circos.axis()` ands `circos.yaxis()`: add axis in a cell.

Following functions arrange the circular layout.

- `circos.initialize()`: allocates sectors on the circle.
- `circos.track()`: creates plotting regions for cells in one single track.
- `circos.update()`: updates an existed cell.
- `circos.par()`: graphic parameters.
- `circos.info()`: prints general parameters of current circular plot.
- `circos.clear()`: resets graphic parameters and internal variables.

Thus, theoretically, you are able to draw most kinds of circular figures by
the above functionalities. Figure \@ref(fig:circlize-example) lists several
complex circular plots made by **circlize**. After going through this
book, you will definitely be able to implement yours.

<div class="figure" style="text-align: center">
<img src="images/ciclize_examples.jpg" alt="Examples by circlize" width="100%" />
<p class="caption">(\#fig:circlize-example)Examples by circlize</p>
</div>

## A quick glance {#a-qiuck-glance}

Before we go too deep into the details, I first demonstrate a simple example
with using basic functionalities in **circlize** package to help you to get
a basic idea of how the package works.

First let's generate some random data. There needs a character vector to
represent categories, a numeric vector of x values and a vectoe of y values.


```r
set.seed(999)
n = 1000
df = data.frame(factors = sample(letters[1:8], n, replace = TRUE),
    x = rnorm(n), y = runif(n))
```

First we initialize the circular layout. The circle is split into sectors
based on the data range on x-axes in each category. In following code, `df$x`
is split by `df$factors` and the width of sectors are automatically calculated
based on data ranges in each category. Be default, sectors are positioned
started from $\theta = 0$ (in the polar coordinate system) and go along the circle
clock-wisely. You may not see anything after running following code because no
track has been added yet.


```r
library(circlize)
circos.par("track.height" = 0.1)
circos.initialize(factors = df$factors, x = df$x)
```

We set a global parameter `track.height` to 0.1 by the option function
`circis.par()` so that all tracks which will be added have a default height of
0.1. The circle used by **circlize** always has a radius of 1, so a height of
0.1 means 10% of the circle radius.

Note that the allocation of sectors only needs values on x direction (or
on the circular direction), the values on y direction (radical direction) will be used
in the step of creating tracks.

After the circular layout is initialized, graphics can be added to the plot in
a track-by-track manner. Before drawing anything, we need to know that all
tracks should be first created by `circos.trackPlotRegion()` or, for short,
`circos.track()`, then the low-level functions can be added afterwards. Just
think in the base R graphic engine, you need first call `plot()` then you can
use functions such as `points()` and `lines()` to add graphics. Since x ranges
for cells in the track have already been defined in the initialization step,
here we only need to specify the y ranges for each cell. The y ranges can be
specified by `y` argument as a numeric vector (so that y ranges will be
automatically extracted and calculated in each cell) or `ylim` argument as a
vector of length two. In principle, y ranges should be same for all cells in a
same track. (See Figure \@ref(fig:circlize-glance-track-1))


```r
circos.track(factors = df$factors, y = df$y,
    panel.fun = function(x, y) {
        circos.text(CELL_META$xcenter, CELL_META$cell.ylim[2] + uy(5, "mm"), 
            CELL_META$sector.index)
        circos.axis(labels.cex = 0.6)
})
col = rep(c("#FF0000", "#00FF00"), 4)
circos.trackPoints(df$factors, df$x, df$y, col = col, pch = 16, cex = 0.5)
circos.text(-1, 0.5, "text", sector.index = "a", track.index = 1)
```
























